{% extends "evoi/base.html" %}
{% block style %}



{% endblock style %}


{% block content %}
      <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.2/p5.js"></script>
      <script src="/static/scripts/p5.dom.js"> </script>
      <script src="/static/scripts/vasarelly.js"> </script>

        <main id="main" role="main">

            <section  class="jumbotron text-center">


                <div id="drawing-section">
                      <evo-drawing v-for="drawing in drawings" v-bind:drawing="drawing" v-bind:key="drawing.id"> </evo-drawing>

                </div>

            </section>





    </main>
<!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Add to collection</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">

                    <div class="input-group mb-3">
                        <input id="text-add-collection" type="text" class="form-control" placeholder="Collection Name" aria-label="Collection Name" aria-describedby="button-add-collection">
                        <div class="input-group-append">
                            <button class="btn btn-outline-primary" type="button" id="button-add-collection">Create</button>
                        </div>
                    </div>


                    <div id="collection_list" class="list-group">



                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
{% endblock content %}

{% block scripts %}

<script type="text/x-template" id="evodrawing-template">
    <div class="container">
         <div :id="drawing.id"  class="container">

        </div>

        <h3 class="jumbotron-heading">[[drawing.name]]</h3>

        <p>
            <button id="get_more" type="button" class="btn btn-primary my-2">Get Another</button>
            <button id="ilike_0" type="button"  class="btn btn-success my-2 ilike">Like</button>

        <div class="btn-group" role="group" aria-label="Basic example">
            <button type="button" class="btn btn-danger dropdown-toggle" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">
                Save to
            </button>
            <div class="dropdown-menu">
                <button v-on:click="public" class="dropdown-item" type="button">Public</button>
                <button v-on:click="private" class="dropdown-item" type="button">Private</button>
            </div>

        </div>
        </p>
    </div>
    </script>




    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="/static/scripts/index.js"></script>




    <script id="collections_template" type="x-tmpl-mustache">

            <li class="list-group-item flex-column align-items-start">
                     <div class="d-flex w-100  justify-content-between">
                         <h5 class="mb-1 text"> [[name]]  </h5>

                                   <button type="button" class="btn btn-primary add-to-collection" data-collection_id="[[id]]" >Save </button>

                     </div>
            </li>
    </script>





<script type="text/javascript">





$('#exampleModal').on('show.bs.modal', function (event) {

  get_collections( $(this), event);

});







function get_collections(modal, event ){

    var button = $(event.relatedTarget);
    var individual = button.data('individual');

    $.get( '/evolve/collections/',{})
                .done(function(data, textStatus, jqXHR) {
                            console.log(data);



            $("#collection_list").empty();

            Mustache.tags = ['[[', ']]'];
            var container_template = $('#collections_template').html();
            Mustache.parse(container_template);   // optional, speeds up future uses
            var rendered = "";

            data.collections.forEach(
                 function(current_collection, index, arr) {


                      rendered = Mustache.render(container_template, {
                                name: current_collection.name,
                                id: current_collection.id});

                      $("#collection_list").append(rendered);

                 });

            $(".add-to-collection").on("click",
                function () {

                    console.log('/evolve/collection/'.concat( $(this).data('collection_id'),individual));
                    if (sample) {

                        $.post('/evolve/collection/'.concat($(this).data('collection_id')), {individual:sample.sample[individual].id})
                            .done(function(data, textStatus, jqXHR) {
                                        console.log(data);
                            });
                    }
                 }
            );
    });

    }





$("#get_more").click(function () {
    if (sample) {
    //    dataRequest();
    }
});





$("#button-add-collection").click(function (event) {
    if (sample) {
        // Get index of item from the button element, id attribute
        // ilike_i
        // if we split on '_' then the index  is the second element of the resulting list

        $.post( '/evolve/collections/',{ name:$('#text-add-collection')[0].value})
            .done(function(data, textStatus, jqXHR) {
                        get_collections($("#exampleModal"),event);
            });
    }

    });

$(".ilike").click(function () {
    if (sample) {
        // Get index of item from the button element, id attribute
        // ilike_i
        // if we split on '_' then the index  is the second element of the resulting list
        var index = $(this)[0].id.split("_")[1];
        var individual = sample.sample[index];
        console.log(individual.id);

        $.post( '/evolve/ilike/',{individual:individual.id})
            .done(function(data, textStatus, jqXHR) {
                        console.log(data);
            });
    }

    });





//dataRequest();

getSample('/EvoSpace/', 3)
  .then(sample => {
        sample.sample.forEach(function(element) {
        app.drawings.push(element);

        var temp =  new p5(s, element.id);
        temp.setChromosome(element.chromosome);
        temp.paint();


});
       // console.log(sample.sample );
        //app.drawings.push({id: "pop:individual:5",name:"mario" });

  });



</script>


  {% endblock scripts %}


